(()=>{var a={};a.id=690,a.ids=[690],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31263:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>_,patchFetch:()=>$,routeModule:()=>W,serverHooks:()=>Z,workAsyncStorage:()=>X,workUnitAsyncStorage:()=>Y});var d={};c.r(d),c.d(d,{GET:()=>V});var e=c(96559),f=c(48088),g=c(37719),h=c(26191),i=c(81289),j=c(261),k=c(92603),l=c(39893),m=c(14823),n=c(47220),o=c(66946),p=c(47912),q=c(99786),r=c(46143),s=c(86439),t=c(43365),u=c(32190),v=c(39793),w=c(35530),x=c(72080),y=c(7007);c(8570);let z={year:0,month:1,day:2,hour:3,minute:4,second:5},A={},B=new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),C="06/25/2014, 00:00:00"===B||"‎06‎/‎25‎/‎2014‎ ‎00‎:‎00‎:‎00"===B;function D(a,b,c,d,e,f,g){let h=new Date(0);return h.setUTCFullYear(a,b,c),h.setUTCHours(d,e,f,g),h}let E={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-])(\d{2}):?(\d{2})$/};function F(a,b,c){let d,e;if(!a)return 0;let f=E.timezoneZ.exec(a);if(f)return 0;if(f=E.timezoneHH.exec(a))return H(d=parseInt(f[1],10))?-(36e5*d):NaN;if(f=E.timezoneHHMM.exec(a)){d=parseInt(f[2],10);let a=parseInt(f[3],10);return H(d,a)?(e=36e5*Math.abs(d)+6e4*a,"+"===f[1]?-e:e):NaN}if(function(a){if(I[a])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:a}),I[a]=!0,!0}catch(a){return!1}}(a)){var g;b=new Date(b||Date.now());let d=G(c?b:D((g=b).getFullYear(),g.getMonth(),g.getDate(),g.getHours(),g.getMinutes(),g.getSeconds(),g.getMilliseconds()),a);return-(c?d:function(a,b,c){let d=a.getTime()-b,e=G(new Date(d),c);if(b===e)return b;let f=G(new Date(d-=e-b),c);return e===f?e:Math.max(e,f)}(b,d,a))}return NaN}function G(a,b){let c=function(a,b){var c;let d=(A[c=b]||(A[c]=C?new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:c,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:c,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),A[c]);return"formatToParts"in d?function(a,b){try{let c=a.formatToParts(b),d=[];for(let a=0;a<c.length;a++){let b=z[c[a].type];void 0!==b&&(d[b]=parseInt(c[a].value,10))}return d}catch(a){if(a instanceof RangeError)return[NaN];throw a}}(d,a):function(a,b){let c=a.format(b),d=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(c);return[parseInt(d[3],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[4],10),parseInt(d[5],10),parseInt(d[6],10)]}(d,a)}(a,b),d=D(c[0],c[1]-1,c[2],c[3]%24,c[4],c[5],0).getTime(),e=a.getTime(),f=e%1e3;return d-(e-=f>=0?f:1e3+f)}function H(a,b){return -23<=a&&a<=23&&(null==b||0<=b&&b<=59)}let I={};function J(a){let b=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return b.setUTCFullYear(a.getFullYear()),a-b}let K=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,L={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:K};function M(a,b={}){if(arguments.length<1)throw TypeError("1 argument required, but only "+arguments.length+" present");if(null===a)return new Date(NaN);let c=null==b.additionalDigits?2:Number(b.additionalDigits);if(2!==c&&1!==c&&0!==c)throw RangeError("additionalDigits must be 0, 1 or 2");if(a instanceof Date||"object"==typeof a&&"[object Date]"===Object.prototype.toString.call(a))return new Date(a.getTime());if("number"==typeof a||"[object Number]"===Object.prototype.toString.call(a))return new Date(a);if("[object String]"!==Object.prototype.toString.call(a))return new Date(NaN);let d=function(a){let b,c={},d=L.dateTimePattern.exec(a);if(d?(c.date=d[1],b=d[3]):(d=L.datePattern.exec(a))?(c.date=d[1],b=d[2]):(c.date=null,b=a),b){let a=L.timeZone.exec(b);a?(c.time=b.replace(a[1],""),c.timeZone=a[1].trim()):c.time=b}return c}(a),{year:e,restDateString:f}=function(a,b){if(a){let c=L.YYY[b],d=L.YYYYY[b],e=L.YYYY.exec(a)||d.exec(a);if(e){let b=e[1];return{year:parseInt(b,10),restDateString:a.slice(b.length)}}if(e=L.YY.exec(a)||c.exec(a)){let b=e[1];return{year:100*parseInt(b,10),restDateString:a.slice(b.length)}}}return{year:null}}(d.date,c),g=function(a,b){let c,d,e;if(null===b)return null;if(!a||!a.length)return(c=new Date(0)).setUTCFullYear(b),c;let f=L.MM.exec(a);if(f)return(c=new Date(0),R(b,d=parseInt(f[1],10)-1))?(c.setUTCFullYear(b,d),c):new Date(NaN);if(f=L.DDD.exec(a)){c=new Date(0);let a=parseInt(f[1],10);return!function(a,b){if(b<1)return!1;let c=Q(a);return(!c||!(b>366))&&(!!c||!(b>365))}(b,a)?new Date(NaN):(c.setUTCFullYear(b,0,a),c)}if(f=L.MMDD.exec(a)){c=new Date(0),d=parseInt(f[1],10)-1;let a=parseInt(f[2],10);return R(b,d,a)?(c.setUTCFullYear(b,d,a),c):new Date(NaN)}if(f=L.Www.exec(a))return S(e=parseInt(f[1],10)-1)?N(b,e):new Date(NaN);if(f=L.WwwD.exec(a)){e=parseInt(f[1],10)-1;let a=parseInt(f[2],10)-1;return S(e,a)?N(b,e,a):new Date(NaN)}return null}(f,e);if(null===g||isNaN(g.getTime())||!g)return new Date(NaN);{let a,c=g.getTime(),e=0;if(d.time&&(null===(e=function(a){let b,c,d=L.HH.exec(a);if(d)return T(b=parseFloat(d[1].replace(",",".")))?b%24*36e5:NaN;if(d=L.HHMM.exec(a))return T(b=parseInt(d[1],10),c=parseFloat(d[2].replace(",",".")))?b%24*36e5+6e4*c:NaN;if(d=L.HHMMSS.exec(a)){b=parseInt(d[1],10),c=parseInt(d[2],10);let a=parseFloat(d[3].replace(",","."));return T(b,c,a)?b%24*36e5+6e4*c+1e3*a:NaN}return null}(d.time))||isNaN(e)))return new Date(NaN);if(d.timeZone||b.timeZone){if(isNaN(a=F(d.timeZone||b.timeZone,new Date(c+e))))return new Date(NaN)}else a=J(new Date(c+e)),a=J(new Date(c+e+a));return new Date(c+e+a)}}function N(a,b,c){b=b||0,c=c||0;let d=new Date(0);d.setUTCFullYear(a,0,4);let e=7*b+c+1-(d.getUTCDay()||7);return d.setUTCDate(d.getUTCDate()+e),d}let O=[31,28,31,30,31,30,31,31,30,31,30,31],P=[31,29,31,30,31,30,31,31,30,31,30,31];function Q(a){return a%400==0||a%4==0&&a%100!=0}function R(a,b,c){if(b<0||b>11)return!1;if(null!=c){if(c<1)return!1;let d=Q(a);if(d&&c>P[b]||!d&&c>O[b])return!1}return!0}function S(a,b){return!(a<0)&&!(a>52)&&(null==b||!(b<0)&&!(b>6))}function T(a,b,c){return!(a<0)&&!(a>=25)&&(null==b||!(b<0)&&!(b>=60))&&(null==c||!(c<0)&&!(c>=60))}function U(a,b,c){return function(a,b,c){let d=F(b,a=M(a,void 0),!0),e=new Date(a.getTime()-d),f=new Date(0);return f.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),f.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),f}(function(a,b,c){if("string"==typeof a&&!a.match(K))return M(a,{...void 0,timeZone:b});let d=D((a=M(a,void 0)).getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()).getTime(),e=F(b,new Date(d));return new Date(d+e)}("string"==typeof a?(0,x.H)(a):a,b),c)}async function V(a,{params:b}){try{let{id:c}=await b,d=await v.q.getPollById(c);if(!d)return u.NextResponse.json((0,w.JV)(404,w.O4.POLL_NOT_FOUND,"Poll not found"),{status:404});let{searchParams:e}=new URL(a.url),f=e.get("timezone"),g=d.timeSlots.map(a=>({id:a.id,date:(0,y.GP)(a.date,"yyyy-MM-dd"),startTime:a.startTime,endTime:a.endTime}));if(f&&f!==d.organizerTimezone)try{console.log("Converting time slots from",d.organizerTimezone,"to",f),console.log("Original time slots:",g.length);let a=function(a,b,c){let d=b===c?a.map(a=>({...a,originalDate:a.date})):a.map(a=>{try{let d=(0,x.H)(`${a.date}T${a.startTime}:00`),e=(0,x.H)(`${a.date}T${a.endTime}:00`),f=U(d,b,c),g=U(e,b,c);return{date:(0,y.GP)(f,"yyyy-MM-dd"),startTime:(0,y.GP)(f,"HH:mm"),endTime:(0,y.GP)(g,"HH:mm"),originalDate:a.date}}catch(b){return console.error(`Error converting time slot ${a.date} ${a.startTime}:`,b),{...a,originalDate:a.date}}}),e=d.filter(a=>{let b=parseInt(a.startTime.split(":")[0]),c=60*b+parseInt(a.startTime.split(":")[1]);return c>=540&&c<=1020});if(0===e.length&&d.length>0){var f=Array.from(new Set(d.map(a=>a.date))).sort();let a=["09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"],b=[];return f.forEach(c=>{a.forEach(a=>{let d=new Date((0,x.H)(`${c}T${a}:00`).getTime()+18e5),e=(0,y.GP)(d,"HH:mm");b.push({date:c,startTime:a,endTime:e})})}),b}return e}(g,d.organizerTimezone,f);console.log("Converted time slots:",a.length);let b=new Map;g.forEach(a=>{let c=`${a.date}-${a.startTime}`;b.set(c,a.id)}),g=a.map((a,c)=>{let e=`${a.originalDate||a.date}-${a.startTime}`;return{id:b.get(e)||`${d.id}-${a.date}-${a.startTime}`,date:a.date,startTime:a.startTime,endTime:a.endTime}}),console.log("Final converted time slots:",g.length)}catch(a){console.error("Error converting time slots for timezone:",a)}let h={...d,timeSlots:g,createdAt:d.createdAt.toISOString(),updatedAt:d.updatedAt.toISOString(),participants:d.participants.map(a=>({...a,createdAt:a.createdAt.toISOString()}))};return u.NextResponse.json(h)}catch(a){return console.error("Error fetching poll:",a),u.NextResponse.json((0,w.JV)(500,w.O4.DATABASE_ERROR,"Failed to fetch poll"),{status:500})}}let W=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/polls/[id]/route",pathname:"/api/polls/[id]",filename:"route",bundlePath:"app/api/polls/[id]/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/clarkwang/Desktop/CodingMisc/BetterMeet/src/app/api/polls/[id]/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:X,workUnitAsyncStorage:Y,serverHooks:Z}=W;function $(){return(0,g.patchFetch)({workAsyncStorage:X,workUnitAsyncStorage:Y})}async function _(a,b,c){var d;let e="/api/polls/[id]/route";"/index"===e&&(e="/");let g=await W.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||W.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===W.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,i.getTracer)(),K=J.getActiveScopeSpan(),L={params:v,prerenderManifest:y,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>W.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},M=new k.NodeNextRequest(a),N=new k.NodeNextResponse(b),O=l.NextRequestAdapter.fromNodeNextRequest(M,(0,l.signalFromNodeResponse)(b));try{let d=async c=>W.handle(O,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=L.renderOpts.fetchMetrics;let i=L.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=L.renderOpts.collectedTags;if(!E)return await (0,o.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await W.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await W.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(M,N,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};K?await g(K):await J.withPropagatedContext(a.headers,()=>J.trace(m.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},g))}catch(b){if(K||b instanceof s.NoFallbackError||await W.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(M,N,new Response(null,{status:500})),null}}},35530:(a,b,c)=>{"use strict";c.d(b,{JV:()=>f,O4:()=>d});var d=function(a){return a.VALIDATION_ERROR="VALIDATION_ERROR",a.INVALID_TIMEZONE="INVALID_TIMEZONE",a.INVALID_DATE_FORMAT="INVALID_DATE_FORMAT",a.INVALID_TIME_FORMAT="INVALID_TIME_FORMAT",a.POLL_NOT_FOUND="POLL_NOT_FOUND",a.PARTICIPANT_NOT_FOUND="PARTICIPANT_NOT_FOUND",a.TIME_SLOT_NOT_FOUND="TIME_SLOT_NOT_FOUND",a.DATABASE_ERROR="DATABASE_ERROR",a.POLL_EXPIRED="POLL_EXPIRED",a.DUPLICATE_PARTICIPANT="DUPLICATE_PARTICIPANT",a.INVALID_AVAILABILITY="INVALID_AVAILABILITY",a.NETWORK_ERROR="NETWORK_ERROR",a.TIMEOUT_ERROR="TIMEOUT_ERROR",a.INTERNAL_SERVER_ERROR="INTERNAL_SERVER_ERROR",a.UNAUTHORIZED="UNAUTHORIZED",a.FORBIDDEN="FORBIDDEN",a.BAD_REQUEST="BAD_REQUEST",a}({});let e={VALIDATION_ERROR:"Please check your input and try again.",INVALID_TIMEZONE:"The selected timezone is not valid.",INVALID_DATE_FORMAT:"Please enter a valid date.",INVALID_TIME_FORMAT:"Please enter a valid time.",POLL_NOT_FOUND:"The requested poll could not be found.",PARTICIPANT_NOT_FOUND:"Participant not found.",TIME_SLOT_NOT_FOUND:"Time slot not found.",DATABASE_ERROR:"A database error occurred. Please try again.",POLL_EXPIRED:"This poll is no longer accepting responses.",DUPLICATE_PARTICIPANT:"A participant with this email already exists.",INVALID_AVAILABILITY:"Invalid availability data provided.",NETWORK_ERROR:"Network error. Please check your connection.",TIMEOUT_ERROR:"Request timed out. Please try again.",INTERNAL_SERVER_ERROR:"An unexpected error occurred.",UNAUTHORIZED:"You are not authorized to perform this action.",FORBIDDEN:"Access to this resource is forbidden.",BAD_REQUEST:"Invalid request. Please check your input."};function f(a,b,c,d){let f=Error(c||e[b]);return f.statusCode=a,f.code=b,f.details=d,f}},39793:(a,b,c)=>{"use strict";c.d(b,{q:()=>g});var d=c(94747),e=c(35530),f=c(7007);class g{static async createPoll(a){try{return await (0,d.ro)(async b=>{let c=await b.poll.create({data:{title:a.title,description:a.description,organizerTimezone:a.organizerTimezone}}),d=a.timeSlots.map(a=>({pollId:c.id,date:new Date(a.date),startTime:a.startTime,endTime:a.endTime}));return await b.timeSlot.createMany({data:d}),await b.poll.findUniqueOrThrow({where:{id:c.id},include:{timeSlots:!0,participants:{include:{availability:!0}}}})})}catch(a){throw console.error("Error creating poll:",a),(0,e.JV)(500,e.O4.DATABASE_ERROR,"Failed to create poll")}}static async getPollById(a){try{return await d.zR.poll.findUnique({where:{id:a},include:{timeSlots:{orderBy:[{date:"asc"},{startTime:"asc"}]},participants:{include:{availability:!0},orderBy:{createdAt:"asc"}}}})}catch(a){throw console.error("Error fetching poll:",a),(0,e.JV)(500,e.O4.DATABASE_ERROR,"Failed to fetch poll")}}static async getPollByIdOrThrow(a){let b=await this.getPollById(a);if(!b)throw(0,e.JV)(404,e.O4.POLL_NOT_FOUND);return b}static async updatePoll(a,b){try{return await d.zR.poll.update({where:{id:a},data:{title:b.title,description:b.description},include:{timeSlots:{orderBy:[{date:"asc"},{startTime:"asc"}]},participants:{include:{availability:!0},orderBy:{createdAt:"asc"}}}})}catch(a){if(console.error("Error updating poll:",a),a&&"object"==typeof a&&"code"in a&&"P2025"===a.code)throw(0,e.JV)(404,e.O4.POLL_NOT_FOUND);throw(0,e.JV)(500,e.O4.DATABASE_ERROR,"Failed to update poll")}}static async deletePoll(a){try{await d.zR.poll.delete({where:{id:a}})}catch(a){if(console.error("Error deleting poll:",a),a&&"object"==typeof a&&"code"in a&&"P2025"===a.code)throw(0,e.JV)(404,e.O4.POLL_NOT_FOUND);throw(0,e.JV)(500,e.O4.DATABASE_ERROR,"Failed to delete poll")}}static async getPollsByDateRange(a,b){try{return await d.zR.poll.findMany({where:{createdAt:{gte:a,lte:b}},include:{timeSlots:{orderBy:[{date:"asc"},{startTime:"asc"}]},participants:{include:{availability:!0},orderBy:{createdAt:"asc"}}},orderBy:{createdAt:"desc"}})}catch(a){throw console.error("Error fetching polls by date range:",a),(0,e.JV)(500,e.O4.DATABASE_ERROR,"Failed to fetch polls")}}static async getPollStats(a){try{let b=await this.getPollByIdOrThrow(a),c=b.timeSlots.length,d=b.participants.length,e=b.participants.reduce((a,b)=>a+b.availability.length,0),g=b.timeSlots.map(a=>{let c=b.participants.filter(b=>b.availability.some(b=>b.timeSlotId===a.id&&b.isAvailable)).length;return{timeSlotId:a.id,date:(0,f.GP)(a.date,"yyyy-MM-dd"),startTime:a.startTime,endTime:a.endTime,availableCount:c,availabilityPercentage:d>0?c/d*100:0}});return{totalTimeSlots:c,totalParticipants:d,totalResponses:e,availabilityByTimeSlot:g,responseRate:c>0?e/(c*d)*100:0}}catch(a){throw console.error("Error getting poll stats:",a),(0,e.JV)(500,e.O4.DATABASE_ERROR,"Failed to get poll statistics")}}}},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},94747:(a,b,c)=>{"use strict";c.d(b,{zR:()=>f,ro:()=>g});let d=require("@prisma/client");var e=c(35530);let f=globalThis.prisma??new d.PrismaClient({log:["error"],errorFormat:"pretty"});async function g(a){try{return await f.$transaction(a)}catch(a){throw console.error("❌ Transaction failed:",a),(0,e.JV)(500,e.O4.DATABASE_ERROR,"Database transaction failed")}}},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[985,832],()=>b(b.s=31263));module.exports=c})();