(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[308],{3165:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>b});var a=l(5155),s=l(2115),r=l(6146),i=l(7290),n=l(6575),o=l(4736),c=l(4554),d=l(3176),m=l(8794),u=l(6477),x=l(7031),h=l(2227);let f=s.forwardRef(function(e,t){let{title:l,titleId:a,...r}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},r),l?s.createElement("title",{id:a},l):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))});var p=l(5529);let g=["09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];function v(e){var t;let{id:l}=e,[v,b]=(0,s.useState)(null),[j,N]=(0,s.useState)(""),[y,w]=(0,s.useState)(""),[S,k]=(0,s.useState)([]),[C,T]=(0,s.useState)(!0),[M,z]=(0,s.useState)(null),[E,P]=(0,s.useState)(!1),[A,D]=(0,s.useState)("select"),[I,U]=(0,s.useState)(!1),[R,L]=(0,s.useState)(!1),[O,Z]=(0,s.useState)(!1),[F,_]=(0,s.useState)(null),[G,H]=(0,s.useState)(null),[V,Y]=(0,s.useState)(null),q=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=sessionStorage.getItem("poll-".concat(l,"-timezone"));if(!e){window.location.href="/poll/".concat(l,"/timezone");return}w(e),U(!0),L(!0)},[l]),(0,s.useEffect)(()=>{y&&I&&B()},[y,I]);let B=async()=>{try{var e;T(!0);let t=y?"/api/polls/".concat(l,"?timezone=").concat(encodeURIComponent(y)):"/api/polls/".concat(l);console.log("Fetching poll with URL:",t),console.log("Participant timezone:",y);let a=await fetch(t);if(!a.ok)throw Error("Poll not found");let s=await a.json();console.log("Poll data received:",s),console.log("Time slots count:",(null==(e=s.timeSlots)?void 0:e.length)||0),b(s)}catch(e){console.error("Error fetching poll:",e),z(e instanceof Error?e.message:"Failed to load poll")}finally{T(!1)}},J=(0,s.useCallback)(e=>{try{return(0,x.qD)((0,m.H)(e),y||(null==v?void 0:v.organizerTimezone)||"UTC","MMM dd")}catch(t){return(0,u.GP)((0,m.H)(e),"MMM dd")}},[y,null==v?void 0:v.organizerTimezone]),W=(0,s.useCallback)(e=>{try{let t=new Date("2000-01-01T".concat(e));return(0,x.qD)(t,y||(null==v?void 0:v.organizerTimezone)||"UTC","h:mm a")}catch(t){return(0,u.GP)(new Date("2000-01-01T".concat(e)),"h:mm a")}},[y,null==v?void 0:v.organizerTimezone]),$=(0,s.useCallback)((e,t)=>{let l="".concat(e,"-").concat(t);return S.includes(l)},[S]),K=(0,s.useCallback)(e=>g.indexOf(e),[]),Q=(0,s.useCallback)(e=>v?Array.from(new Set(v.timeSlots.map(e=>e.date))).sort().indexOf(e):-1,[v]),X=(0,s.useCallback)((e,t)=>{if(!F||!G)return!1;let l=Q(F.date),a=Q(G.date),s=K(F.timeSlot),r=K(G.timeSlot),i=Q(e),n=K(t),o=Math.min(l,a),c=Math.max(l,a),d=Math.min(s,r),m=Math.max(s,r);return i>=o&&i<=c&&n>=d&&n<=m},[F,G,Q,K]),ee=(0,s.useCallback)((e,t)=>{if(!I)return;let l=$(e,t);Z(!0),_({date:e,timeSlot:t}),H({date:e,timeSlot:t}),Y(l?"deselect":"select");let a="".concat(e,"-").concat(t);l?k(e=>e.filter(e=>e!==a)):k(e=>[...e,a])},[$,I]),et=(0,s.useCallback)((e,t)=>{O&&F&&V&&H({date:e,timeSlot:t})},[O,F,V]),el=(0,s.useCallback)(()=>{if(O&&F&&G&&V&&v){let e=Q(F.date),t=Q(G.date),l=K(F.timeSlot),a=K(G.timeSlot),s=Math.min(e,t),r=Math.max(e,t),i=Math.min(l,a),n=Math.max(l,a);if(Array.from(new Set(v.timeSlots.map(e=>e.date))).sort(),"deselect"===V)k(e=>e.filter(e=>{let[t,l]=e.split("-");if(t&&l){let e=Q(t),a=K(l);return!(e>=s&&e<=r&&a>=i&&a<=n)}return!0}));else{let e=[];for(let t=s;t<=r;t++)for(let l=i;l<=n;l++){let a=en[t],s=g[l];a&&s&&e.push("".concat(a,"-").concat(s))}k(t=>Array.from(new Set([...t,...e])))}}Z(!1),_(null),H(null),Y(null)},[O,F,G,V,Q,K,v]),ea=(0,s.useCallback)((e,t)=>{let l;if(!v)return 0;let a="".concat(e,"-").concat(t),s=0;return l=1,v.timeSlots.some(l=>l.date===e&&l.startTime===t)&&(s+=1),v.participants&&v.participants.length>0&&(l+=v.participants.length,s+=v.participants.filter(l=>{var s;return null==(s=l.availability)?void 0:s.some(l=>l.timeSlotId===a||l.timeSlotId&&v.timeSlots.find(a=>a.id===l.timeSlotId&&a.date===e&&a.startTime===t))}).length),S.length>0&&(l+=1,S.includes(a)&&(s+=1)),l>0?s/l*100:0},[v,S]),es=(0,s.useCallback)((e,t)=>{if(!v)return 0;let l="".concat(e,"-").concat(t),a=0;return v.timeSlots.some(l=>l.date===e&&l.startTime===t)&&(a+=1),v.participants&&v.participants.length>0&&(a+=v.participants.filter(a=>{var s;return null==(s=a.availability)?void 0:s.some(a=>a.timeSlotId===l||a.timeSlotId&&v.timeSlots.find(l=>l.id===a.timeSlotId&&l.date===e&&l.startTime===t))}).length),S.length>0&&S.includes(l)&&(a+=1),a},[v,S]),er=(0,s.useCallback)((e,t)=>{if(!v)return 0;let l=1;return v.participants&&v.participants.length>0&&(l+=v.participants.length),S.length>0&&(l+=1),l},[v,S]),ei=async()=>{if(!j.trim())return void z("Please provide your name");try{if(P(!0),!(await fetch("/api/polls/".concat(l,"/vote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:j,timezone:y,selectedSlots:S})})).ok)throw Error("Failed to submit vote");N(""),k([]),z(null),alert("Vote submitted successfully!")}catch(e){z(e instanceof Error?e.message:"Failed to submit vote")}finally{P(!1)}};if(C||!R)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-foreground-600",children:"Loading poll..."})]})});if(M||!v)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-foreground mb-4",children:"Poll Not Found"}),(0,a.jsx)("p",{className:"text-foreground-600 mb-6",children:M||"The poll you are looking for does not exist."}),(0,a.jsx)(r.T,{color:"primary",href:"/",children:"Go Home"})]})});let en=Array.from(new Set(v.timeSlots.map(e=>e.date))).sort();return 0===v.timeSlots.length?(0,a.jsx)("div",{className:"min-h-screen bg-background p-4",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[(0,a.jsx)(i.Z,{className:"w-full",children:(0,a.jsx)(n.d,{className:"pb-0",children:(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:v.title}),v.description&&(0,a.jsx)("p",{className:"text-foreground-600 text-lg",children:v.description})]})})}),(0,a.jsx)(i.Z,{className:"w-full",children:(0,a.jsx)(o.U,{className:"p-8 text-center",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"text-6xl",children:"\uD83D\uDD50"}),(0,a.jsx)("h2",{className:"text-2xl font-semibold text-foreground",children:"No Available Time Slots"}),(0,a.jsxs)("p",{className:"text-foreground-600 max-w-md mx-auto",children:["The time slots for this poll don't align with business hours (9 AM - 5 PM) in your timezone (",y,")."]}),(0,a.jsx)("div",{className:"pt-4",children:(0,a.jsx)(r.T,{color:"primary",onPress:()=>window.location.href="/poll/".concat(l,"/timezone"),className:"text-white",children:"Change Timezone"})})]})})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-background p-4",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[(0,a.jsx)(i.Z,{className:"w-full",children:(0,a.jsx)(n.d,{className:"pb-0",children:(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:v.title}),v.description&&(0,a.jsx)("p",{className:"text-foreground-600 text-lg",children:v.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 mt-4",children:[(0,a.jsxs)(c.R,{color:"primary",variant:"flat",startContent:(0,a.jsx)(h.A,{className:"w-4 h-4"}),children:[v.timeSlots.length," time slots"]}),(0,a.jsxs)(c.R,{color:"secondary",variant:"flat",startContent:(0,a.jsx)(f,{className:"w-4 h-4"}),children:[(null==(t=v.participants)?void 0:t.length)||0," participants"]})]})]})})}),(0,a.jsxs)(i.Z,{className:"w-full",children:[(0,a.jsx)(n.d,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:"select"===A?"Select Your Availability":"Group Availability"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm text-foreground-600",children:"View:"}),(0,a.jsx)(r.T,{size:"sm",variant:"select"===A?"solid":"bordered",color:"primary",onPress:()=>D("select"),className:"select"===A?"text-white":"",children:"My Selection"}),(0,a.jsx)(r.T,{size:"sm",variant:"availability"===A?"solid":"bordered",color:"primary",onPress:()=>D("availability"),className:"availability"===A?"text-white":"",children:"Group View"})]})]})}),(0,a.jsx)(o.U,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{ref:q,className:"overflow-x-auto overflow-y-auto max-h-96",onMouseUp:el,onMouseLeave:el,children:(0,a.jsxs)("div",{className:"min-w-max",children:[(0,a.jsxs)("div",{className:"grid gap-1 mb-2",style:{gridTemplateColumns:"120px repeat(".concat(en.length,", 1fr)")},children:[(0,a.jsx)("div",{className:"h-8"})," ",en.map(e=>(0,a.jsx)("div",{className:"h-8 flex items-center justify-center text-sm font-medium text-foreground bg-foreground-50 rounded-lg",children:J(e)},e))]}),(0,a.jsx)("div",{className:"grid gap-1",style:{gridTemplateColumns:"120px repeat(".concat(en.length,", 1fr)")},children:g.map(e=>(0,a.jsxs)(s.Fragment,{children:[(0,a.jsx)("div",{className:"h-8 flex items-center justify-end pr-3 text-sm text-foreground-600 font-medium",children:W(e)}),en.map(t=>{let l=$(t,e),s=X(t,e),r=ea(t,e);return(0,a.jsx)("button",{onMouseDown:()=>ee(t,e),onMouseEnter:()=>et(t,e),disabled:!I,className:"\n                                 h-8 border border-divider rounded transition-all duration-150 relative\n                                 ".concat(!I?"bg-foreground-100 cursor-not-allowed opacity-50":"availability"===A?"cursor-pointer":l||s?"bg-primary-500 border-primary-600":"bg-foreground-50 hover:bg-foreground-100 cursor-pointer","\n                                 ").concat(O&&I?"cursor-crosshair":"","\n                               "),style:{backgroundColor:"availability"===A&&I?(e=>{if(0===e)return"transparent";let t=Math.max(.1,e/100);return"rgba(59, 130, 246, ".concat(t,")")})(r):void 0},title:"availability"===A&&I?"".concat(es(t,e),"/").concat(er(t,e)," participants available"):void 0,children:"availability"===A&&I&&r>0&&(0,a.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-white drop-shadow-sm",children:[es(t,e),"/",er(t,e)]})},"".concat(t,"-").concat(e))})]},e))})]})}),(0,a.jsx)("p",{className:"text-sm text-foreground-500 text-center",children:I?"select"===A?"Select any time slots on the available dates. Click and drag to select multiple.":"Darker blue indicates more participants are available. Hover for details.":"Please select your timezone first to view and select time slots"})]})})]}),(0,a.jsxs)(i.Z,{className:"w-full",children:[(0,a.jsx)(n.d,{children:(0,a.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:"Submit Your Vote"})}),(0,a.jsx)(o.U,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(d.r,{label:"Your Name",placeholder:"Enter your name",value:j,onChange:e=>N(e.target.value),isRequired:!0,className:"w-full"}),(0,a.jsx)("div",{className:"p-4 bg-primary-50 border border-primary-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"w-5 h-5 text-primary-600"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-primary-700",children:["Your timezone: ",y]})]})}),M&&(0,a.jsx)("div",{className:"p-4 bg-danger-50 border border-danger-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-danger text-sm font-medium",children:M})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-foreground-600",children:["Selected: ",S.length," time slot",1!==S.length?"s":""]}),(0,a.jsx)(r.T,{color:"primary",onPress:ei,isLoading:E,disabled:0===S.length,className:"text-white",children:"Submit Vote"})]})]})})]})]})})}function b(e){let{params:t}=e,[l,r]=s.useState("");return(s.useEffect(()=>{t.then(e=>r(e.id))},[t]),l)?(0,a.jsx)(v,{id:l}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-foreground-600",children:"Loading..."})]})})}},4236:(e,t,l)=>{Promise.resolve().then(l.bind(l,3165))},6575:(e,t,l)=>{"use strict";l.d(t,{d:()=>c});var a=l(2881),s=l(6973),r=l(6548),i=l(5712),n=l(5155),o=(0,s.Rf)((e,t)=>{var l;let{as:s,className:o,children:c,...d}=e,m=(0,r.zD)(t),{slots:u,classNames:x}=(0,a.f)(),h=(0,i.$)(null==x?void 0:x.header,o);return(0,n.jsx)(s||"div",{ref:m,className:null==(l=u.header)?void 0:l.call(u,{class:h}),...d,children:c})});o.displayName="NextUI.CardHeader";var c=o}},e=>{e.O(0,[204,494,790,441,964,358],()=>e(e.s=4236)),_N_E=e.O()}]);